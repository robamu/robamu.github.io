<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Bringing Rust to Space - Setting up a Rust ecosystem for the VA108XX MCU family | hi, I am robin</title>
<meta name=keywords content="rust,embedded,space,va10820"><meta name=description content="UPDATE 2024
I have recently converted the VA108xx Rust support into monocrates which can now be found
here. I have also started working on the
support for the VA416XX family of devices which can be found here.
The new repositories also now use the embedded-hal v1 release.
Blogpost
The last few weeks I have been busy diving into the Rust ecosystem and learning the language
through practical projects. I finishing the excellent
Rust book and the Rust Embedded Book
first and then tinkered with Rust on some STM32 MCUs. As a next step, I was looking for practical
projects to further learn the language. I&rsquo;ve tried to combine this with the usual activities at
the research institute I work now as well."><meta name=author content><link rel=canonical href=https://robamu.github.io/blog/rust-ecosystem/><link crossorigin=anonymous href=/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF+13Dyqob6ASlTrTye8=" rel="preload stylesheet" as=style><link rel=icon href=https://robamu.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://robamu.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://robamu.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://robamu.github.io/apple-touch-icon.png><link rel=mask-icon href=https://robamu.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://robamu.github.io/blog/rust-ecosystem/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://robamu.github.io/blog/rust-ecosystem/"><meta property="og:site_name" content="hi, I am robin"><meta property="og:title" content="Bringing Rust to Space - Setting up a Rust ecosystem for the VA108XX MCU family"><meta property="og:description" content="UPDATE 2024 I have recently converted the VA108xx Rust support into monocrates which can now be found here. I have also started working on the support for the VA416XX family of devices which can be found here. The new repositories also now use the embedded-hal v1 release.
Blogpost The last few weeks I have been busy diving into the Rust ecosystem and learning the language through practical projects. I finishing the excellent Rust book and the Rust Embedded Book first and then tinkered with Rust on some STM32 MCUs. As a next step, I was looking for practical projects to further learn the language. I’ve tried to combine this with the usual activities at the research institute I work now as well."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2021-12-15T23:31:00+01:00"><meta property="article:modified_time" content="2024-06-26T23:12:59+02:00"><meta property="article:tag" content="Rust"><meta property="article:tag" content="Embedded"><meta property="article:tag" content="Space"><meta property="article:tag" content="Va10820"><meta name=twitter:card content="summary"><meta name=twitter:title content="Bringing Rust to Space - Setting up a Rust ecosystem for the VA108XX MCU family"><meta name=twitter:description content="UPDATE 2024
I have recently converted the VA108xx Rust support into monocrates which can now be found
here. I have also started working on the
support for the VA416XX family of devices which can be found here.
The new repositories also now use the embedded-hal v1 release.
Blogpost
The last few weeks I have been busy diving into the Rust ecosystem and learning the language
through practical projects. I finishing the excellent
Rust book and the Rust Embedded Book
first and then tinkered with Rust on some STM32 MCUs. As a next step, I was looking for practical
projects to further learn the language. I&rsquo;ve tried to combine this with the usual activities at
the research institute I work now as well."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"","item":"https://robamu.github.io/blog/"},{"@type":"ListItem","position":2,"name":"Bringing Rust to Space - Setting up a Rust ecosystem for the VA108XX MCU family","item":"https://robamu.github.io/blog/rust-ecosystem/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Bringing Rust to Space - Setting up a Rust ecosystem for the VA108XX MCU family","name":"Bringing Rust to Space - Setting up a Rust ecosystem for the VA108XX MCU family","description":"UPDATE 2024 I have recently converted the VA108xx Rust support into monocrates which can now be found here. I have also started working on the support for the VA416XX family of devices which can be found here. The new repositories also now use the embedded-hal v1 release.\nBlogpost The last few weeks I have been busy diving into the Rust ecosystem and learning the language through practical projects. I finishing the excellent Rust book and the Rust Embedded Book first and then tinkered with Rust on some STM32 MCUs. As a next step, I was looking for practical projects to further learn the language. I\u0026rsquo;ve tried to combine this with the usual activities at the research institute I work now as well.\n","keywords":["rust","embedded","space","va10820"],"articleBody":"UPDATE 2024 I have recently converted the VA108xx Rust support into monocrates which can now be found here. I have also started working on the support for the VA416XX family of devices which can be found here. The new repositories also now use the embedded-hal v1 release.\nBlogpost The last few weeks I have been busy diving into the Rust ecosystem and learning the language through practical projects. I finishing the excellent Rust book and the Rust Embedded Book first and then tinkered with Rust on some STM32 MCUs. As a next step, I was looking for practical projects to further learn the language. I’ve tried to combine this with the usual activities at the research institute I work now as well.\nWorking at an insitute which builds small satellites gives me access to unique hardware like the radiation hardened Vorago MCUs which are usually not used by hobbyist because of their price tag. 3-4 digits are very common even for basic radiation hardened components. Some of these MCUs are used in our CubeSat projects and I was curious whether I could set up Rust for some of the MCUs, namely the VA10820 Cortex-M0 based MCU. Vorago sells some of their chips on a Vorago development board named REB1 and I was able to get my hands on one.\nBrowsing the internet a bit, I quickly found out that nobody attempted to create supporting libraries for these MCUs yet. I thought this was an excellent opportunity to learn a lot of aspects of Embedded Rust. The Rust book had an excellent picture of what a ecosystem for a particular MCU family or board might look like\nEmbedded Rust Abstraction Layers\nI started with the lowest necessary level to build higher level abstractions: The Peripheral Access Crate (PAC). After a few tweaks to the vendor supplied SVD file and the svd2rust tool, I was able to generate my first own PAC.\nI then set up the blinky application as the classical first application for a new MCU to test my PAC. This is what it looks like\n#![no_main] #![no_std] use cortex_m_rt::entry; use panic_halt as _; use va108xx as pac; // REB LED pin definitions. All on port A const LED_D2: u32 = 1 \u003c\u003c 10; const LED_D3: u32 = 1 \u003c\u003c 7; const LED_D4: u32 = 1 \u003c\u003c 6; #[entry] fn main() -\u003e ! { let dp = pac::Peripherals::take().unwrap(); // Enable all peripheral clocks dp.SYSCONFIG .peripheral_clk_enable .modify(|_, w| unsafe { w.bits(0xffffffff) }); dp.PORTA .dir() .modify(|_, w| unsafe { w.bits(LED_D2 | LED_D3 | LED_D4) }); dp.PORTA .datamask() .modify(|_, w| unsafe { w.bits(LED_D2 | LED_D3 | LED_D4) }); for _ in 0..10 { dp.PORTA .clrout() .write(|w| unsafe { w.bits(LED_D2 | LED_D3 | LED_D4) }); cortex_m::asm::delay(5_000_000); dp.PORTA .setout() .write(|w| unsafe { w.bits(LED_D2 | LED_D3 | LED_D4) }); cortex_m::asm::delay(5_000_000); } loop { dp.PORTA .togout() .write(|w| unsafe { w.bits(LED_D2 | LED_D3 | LED_D4) }); cortex_m::asm::delay(25_000_000); } } With the JLink tools installed and a few helper files in place you can find in my workspace, I started the JLinkGDBServer and then flashed the board with\ncargo run -p va108xx-hal --example blinky-pac Blinky in action\nLooking good!\nNow, the next challenge was to write the next level of abstraction: A Hardware Abstraction Layer (HAL) crate. I started browsing some of the HALs like the stm32f1xx-hal and intially felt overwhelmed by all the new syntax, macros and ways to write Rust code I have not seen before. But I also thought that implementing this for a new MCU family would be an excellent way to learn a lot.\nYou can find the first version I eventually was able to hack together here. The most challenging task was to wrap around my head around the typesystem and the macro system. Since then, I refactored the GPIO library to use even more type-level features based on the excellent atsamd HAL.\nThe blinky example using the hardware abstraction layer looks like this\n#![no_main] #![no_std] use cortex_m_rt::entry; use embedded_hal::digital::v2::ToggleableOutputPin; use panic_halt as _; use va108xx_hal::{gpio::PinsA, pac, prelude::*}; #[entry] fn main() -\u003e ! { let mut dp = pac::Peripherals::take().unwrap(); let porta = PinsA::new(\u0026mut dp.SYSCONFIG, Some(dp.IOCONFIG), dp.PORTA); let mut led1 = porta.pa10.into_push_pull_output(); let mut led2 = porta.pa7.into_push_pull_output(); let mut led3 = porta.pa6.into_push_pull_output(); for _ in 0..10 { led1.set_low().ok(); led2.set_low().ok(); led3.set_low().ok(); cortex_m::asm::delay(5_000_000); led1.set_high().ok(); led2.set_high().ok(); led3.set_high().ok(); cortex_m::asm::delay(5_000_000); } loop { led1.toggle().ok(); cortex_m::asm::delay(5_000_000); led2.toggle().ok(); cortex_m::asm::delay(5_000_000); led3.toggle().ok(); cortex_m::asm::delay(5_000_000); } } A lot more readble and neat that the low level PAC version.\nEquipped with a lot more knowledge, I implemented a HAL for all other peripherals, using what I saw in different HALs like the ATSAMD HAL or the STM32 HALs. Writing the basic blocking API was mostly straighforward once I got more familiar with writing HAL code. I still have to write code which is able to use interrupts to efficiently clear the various FIFOs. Using these FIFOs reduces CPU load is the only sensible for peripherals like the UART to efficiently receive all arriving RX data.\nAs a final step, I also implemented a Board Support Package targeted towards the REB1 development board. This also was an excellent way for me to test the I2C implementation because that board was equiped with a simple ADT75 I2C temperature sensor device.\nThe example application looks like this now\n#![no_main] #![no_std] use cortex_m_rt::entry; use panic_rtt_target as _; use rtt_target::{rprintln, rtt_init_print}; use va108xx_hal::{ pac::{self, interrupt}, prelude::*, timer::{default_ms_irq_handler, set_up_ms_timer, Delay}, }; use vorago_reb1::temp_sensor::Adt75TempSensor; #[entry] fn main() -\u003e ! { rtt_init_print!(); rprintln!(\"-- Vorago Temperature Sensor and I2C Example --\"); let mut dp = pac::Peripherals::take().unwrap(); let tim0 = set_up_ms_timer( \u0026mut dp.SYSCONFIG, \u0026mut dp.IRQSEL, 50.mhz().into(), dp.TIM0, interrupt::OC0, ); let mut delay = Delay::new(tim0); unsafe { cortex_m::peripheral::NVIC::unmask(pac::Interrupt::OC0); } let mut temp_sensor = Adt75TempSensor::new(dp.I2CA, 50.mhz(), Some(\u0026mut dp.SYSCONFIG)) .expect(\"Creating temperature sensor struct failed\"); loop { let temp = temp_sensor .read_temperature() .expect(\"Failed reading temperature\"); rprintln!(\"Temperature in Celcius: {}\", temp); delay.delay_ms(500); } } #[interrupt] fn OC0() { default_ms_irq_handler(); } In my opinion, all the abstractions made this code really neat a brief. In this example, one can also see a few more features being used:\nThe RTT logger, which worked more or less out of the box. Really useful to get debugging output An interrupt being used to get a MS timer tick. The Cortex-M0 does not really have a SysTick peripheral suitable for this task, but the 24 TIM peripherals can be set up to generate millisecond or second interrupts without issues. For something common like a millisecond counter, I set up default setup functions and IRQ handlers like seen in the code above. A temperature sensor abstraction provided by the BSP, which makes this example application really concise. And this is what the output looks like after flashing the board with\ncargo run --example adt75-temp-sensor Reading a temperature sensor in Rust\nI would also like to write a bit about the development workflow I am using. It is possible doing debugging using a graphical user interface which is important for any application which is more complex in my opinion. I am using VS code for this and I’m really happy with the development workflow. All that is required is the Cortex-Debug plugin.\nAn example launch.json file for VS code looks like this\n{ \"version\": \"0.2.0\", \"configurations\": [ { \"type\": \"cortex-debug\", \"request\": \"launch\", \"name\": \"Debug Blinky\", \"servertype\": \"jlink\", \"cwd\": \"${workspaceRoot}\", \"device\": \"VA10820\", \"svdFile\": \"../va108xx-rs/va108xx.svd\", \"preLaunchTask\": \"rust: cargo build minimal blinky\", \"executable\": \"${workspaceFolder}/target/thumbv6m-none-eabi/debug/examples/blinky-leds\", \"interface\": \"jtag\", \"runToMain\": true, }, ] } and an example tasks.json file like this\n{ \"version\": \"2.0.0\", \"tasks\": [ { \"label\": \"rust: cargo build blinky\", \"type\": \"shell\", \"command\": \"~/.cargo/bin/cargo\", // note: full path to the cargo \"args\": [ \"build\", \"--example\", \"blinky-leds\", ], \"group\": { \"kind\": \"build\", \"isDefault\": true } }, ] } with this, we can soon use the Run \u0026 Debug tab of VS code to debug our applications\nDebugging with VS Code\nImplementing a full Rust ecosystem for the VA10820 has been a challenging but satisfying task. I think Rust offers excellent features which are really useful to write safe code for space applications and I hope that some of the code I have written will be used to run awesome missions soon.\nIn the meantime, I also managed to procure a PEB1 development board for the VA416xx familyof devices. I also want to thank Thales Alenia Space for providing me with this expensive hardware. I am also trying to get the industry version of the SAMRH71 MCU. Time to write more Rust code!\n","wordCount":"1390","inLanguage":"en","datePublished":"2021-12-15T23:31:00+01:00","dateModified":"2024-06-26T23:12:59+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://robamu.github.io/blog/rust-ecosystem/"},"publisher":{"@type":"Organization","name":"hi, I am robin","logo":{"@type":"ImageObject","url":"https://robamu.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://robamu.github.io/ accesskey=h title="hi, I am robin (Alt + H)">hi, I am robin</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://robamu.github.io/ title=Home><span>Home</span></a></li><li><a href=https://robamu.github.io/projects/ title=Projects><span>Projects</span></a></li><li><a href=https://robamu.github.io/blog/ title=Blog><span>Blog</span></a></li><li><a href=https://robamu.github.io/sat-rs/book/ title="sat-rs book"><span>sat-rs book</span></a></li><li><a href=https://robamu.github.io/contact/ title=Contact><span>Contact</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Bringing Rust to Space - Setting up a Rust ecosystem for the VA108XX MCU family</h1><div class=post-meta><span title='2021-12-15 23:31:00 +0100 +0100'>December 15, 2021</span>&nbsp;·&nbsp;7 min&nbsp;·&nbsp;<span id=4d8e60a746ede7e91ddac293f50c1456 title=Views>? Views</span>
<script>var r=new XMLHttpRequest;r.addEventListener("load",function(){document.getElementById("4d8e60a746ede7e91ddac293f50c1456").innerHTML=JSON.parse(this.responseText).count_unique+" Views"}),r.open("GET","https://robamu.goatcounter.com/counter/"+encodeURIComponent("/blog/rust-ecosystem/".replace(/(\/)?$/,""))+".json"),r.send()</script></div></header><div class=post-content><h1 id=update-2024>UPDATE 2024<a hidden class=anchor aria-hidden=true href=#update-2024>#</a></h1><p>I have recently converted the VA108xx Rust support into monocrates which can now be found
<a href=https://egit.irs.uni-stuttgart.de/rust/va108xx-rs>here</a>. I have also started working on the
support for the VA416XX family of devices which can be found <a href=https://egit.irs.uni-stuttgart.de/rust/va416xx-rs>here</a>.
The new repositories also now use the <code>embedded-hal</code> v1 release.</p><h1 id=blogpost>Blogpost<a hidden class=anchor aria-hidden=true href=#blogpost>#</a></h1><p>The last few weeks I have been busy diving into the Rust ecosystem and learning the language
through practical projects. I finishing the excellent
<a href=https://doc.rust-lang.org/book/>Rust book</a> and the <a href=https://docs.rust-embedded.org/book/>Rust Embedded Book</a>
first and then tinkered with Rust on some STM32 MCUs. As a next step, I was looking for practical
projects to further learn the language. I&rsquo;ve tried to combine this with the usual activities at
the research institute I work now as well.</p><p>Working at an insitute which builds small satellites gives me access to unique hardware like
the radiation hardened Vorago MCUs which are usually not used by hobbyist because of their
price tag. 3-4 digits are very common even for basic radiation hardened components.
Some of these MCUs are used in our CubeSat projects and I was
curious whether I could set up Rust for some of the MCUs, namely the VA10820 Cortex-M0 based MCU.
Vorago sells some of their chips on a Vorago development board named REB1 and I was able to get my
hands on one.</p><p>Browsing the internet a bit, I quickly found out that nobody attempted to create supporting
libraries for these MCUs yet. I thought this was an excellent opportunity to learn a lot of
aspects of Embedded Rust. The Rust book had an excellent picture of what a ecosystem for a particular
MCU family or board might look like</p><center><figure><img loading=lazy src=/img/rust-ecosystem/crates.png alt="Embedded Rust Abstraction Layers"><figcaption><p>Embedded Rust Abstraction Layers</p></figcaption></figure></center><p>I started with the lowest necessary level to build higher level abstractions:
The Peripheral Access Crate (PAC). After a few tweaks to the vendor supplied SVD file and the
<code>svd2rust</code> tool, I was able to generate my first own PAC.</p><p>I then set up the blinky application as the classical first application for a new MCU to test
my PAC. This is what it looks like</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rs data-lang=rs><span class=line><span class=cl><span class=cp>#![no_main]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cp>#![no_std]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>use</span><span class=w> </span><span class=n>cortex_m_rt</span>::<span class=n>entry</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>use</span><span class=w> </span><span class=n>panic_halt</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>_</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>use</span><span class=w> </span><span class=n>va108xx</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>pac</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// REB LED pin definitions. All on port A
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>const</span><span class=w> </span><span class=no>LED_D2</span>: <span class=kt>u32</span> <span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=mi>10</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>const</span><span class=w> </span><span class=no>LED_D3</span>: <span class=kt>u32</span> <span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=mi>7</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>const</span><span class=w> </span><span class=no>LED_D4</span>: <span class=kt>u32</span> <span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=mi>6</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cp>#[entry]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span>-&gt; <span class=o>!</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>dp</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>pac</span>::<span class=n>Peripherals</span>::<span class=n>take</span><span class=p>().</span><span class=n>unwrap</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Enable all peripheral clocks
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=n>dp</span><span class=p>.</span><span class=no>SYSCONFIG</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=n>peripheral_clk_enable</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=n>modify</span><span class=p>(</span><span class=o>|</span><span class=n>_</span><span class=p>,</span><span class=w> </span><span class=n>w</span><span class=o>|</span><span class=w> </span><span class=k>unsafe</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>w</span><span class=p>.</span><span class=n>bits</span><span class=p>(</span><span class=mh>0xffffffff</span><span class=p>)</span><span class=w> </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>dp</span><span class=p>.</span><span class=no>PORTA</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=n>dir</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=n>modify</span><span class=p>(</span><span class=o>|</span><span class=n>_</span><span class=p>,</span><span class=w> </span><span class=n>w</span><span class=o>|</span><span class=w> </span><span class=k>unsafe</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>w</span><span class=p>.</span><span class=n>bits</span><span class=p>(</span><span class=no>LED_D2</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=no>LED_D3</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=no>LED_D4</span><span class=p>)</span><span class=w> </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>dp</span><span class=p>.</span><span class=no>PORTA</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=n>datamask</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=n>modify</span><span class=p>(</span><span class=o>|</span><span class=n>_</span><span class=p>,</span><span class=w> </span><span class=n>w</span><span class=o>|</span><span class=w> </span><span class=k>unsafe</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>w</span><span class=p>.</span><span class=n>bits</span><span class=p>(</span><span class=no>LED_D2</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=no>LED_D3</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=no>LED_D4</span><span class=p>)</span><span class=w> </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=n>_</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=mi>0</span><span class=o>..</span><span class=mi>10</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>dp</span><span class=p>.</span><span class=no>PORTA</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=n>clrout</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=n>write</span><span class=p>(</span><span class=o>|</span><span class=n>w</span><span class=o>|</span><span class=w> </span><span class=k>unsafe</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>w</span><span class=p>.</span><span class=n>bits</span><span class=p>(</span><span class=no>LED_D2</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=no>LED_D3</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=no>LED_D4</span><span class=p>)</span><span class=w> </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>cortex_m</span>::<span class=n>asm</span>::<span class=n>delay</span><span class=p>(</span><span class=mi>5_000_000</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>dp</span><span class=p>.</span><span class=no>PORTA</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=n>setout</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=n>write</span><span class=p>(</span><span class=o>|</span><span class=n>w</span><span class=o>|</span><span class=w> </span><span class=k>unsafe</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>w</span><span class=p>.</span><span class=n>bits</span><span class=p>(</span><span class=no>LED_D2</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=no>LED_D3</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=no>LED_D4</span><span class=p>)</span><span class=w> </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>cortex_m</span>::<span class=n>asm</span>::<span class=n>delay</span><span class=p>(</span><span class=mi>5_000_000</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>loop</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>dp</span><span class=p>.</span><span class=no>PORTA</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=n>togout</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=n>write</span><span class=p>(</span><span class=o>|</span><span class=n>w</span><span class=o>|</span><span class=w> </span><span class=k>unsafe</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>w</span><span class=p>.</span><span class=n>bits</span><span class=p>(</span><span class=no>LED_D2</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=no>LED_D3</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=no>LED_D4</span><span class=p>)</span><span class=w> </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>cortex_m</span>::<span class=n>asm</span>::<span class=n>delay</span><span class=p>(</span><span class=mi>25_000_000</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>With the JLink tools installed and a few helper files in place you can find in my
<a href=https://egit.irs.uni-stuttgart.de/rust/va108xx-workspace>workspace</a>, I started the <code>JLinkGDBServer</code>
and then flashed the board with</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>cargo run -p va108xx-hal --example blinky-pac
</span></span></code></pre></div><center><figure><img loading=lazy src=/gif/rust-ecosystem/vor-blinky.gif alt="Blinky GIF"><figcaption><p>Blinky in action</p></figcaption></figure></center><p>Looking good!</p><p>Now, the next challenge was to write the next level of abstraction: A Hardware Abstraction
Layer (HAL) crate. I started browsing some of the HALs like the
<a href=https://github.com/stm32-rs/stm32f1xx-hal/blob/master/src/gpio.rs>stm32f1xx-hal</a> and intially
felt overwhelmed by all the new syntax, macros and ways to write Rust code I have not seen before.
But I also thought that implementing this for a new MCU family would be an excellent way to learn
a lot.</p><p>You can find the first version I eventually was able to hack together
<a href=https://github.com/robamu-org/va108xx-hal-rs/blob/v0.1.0/src/gpio.rs>here</a>.
The most challenging task was to wrap around my head around the typesystem and the macro system.
Since then, I refactored the GPIO library to use even more type-level features based on the
excellent <a href=https://docs.rs/atsamd-hal/latest/atsamd_hal/gpio/v2/index.html>atsamd HAL</a>.</p><p>The blinky example using the hardware abstraction layer looks like this</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rs data-lang=rs><span class=line><span class=cl><span class=cp>#![no_main]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cp>#![no_std]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>use</span><span class=w> </span><span class=n>cortex_m_rt</span>::<span class=n>entry</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>use</span><span class=w> </span><span class=n>embedded_hal</span>::<span class=n>digital</span>::<span class=n>v2</span>::<span class=n>ToggleableOutputPin</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>use</span><span class=w> </span><span class=n>panic_halt</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>_</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>use</span><span class=w> </span><span class=n>va108xx_hal</span>::<span class=p>{</span><span class=n>gpio</span>::<span class=n>PinsA</span><span class=p>,</span><span class=w> </span><span class=n>pac</span><span class=p>,</span><span class=w> </span><span class=n>prelude</span>::<span class=o>*</span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cp>#[entry]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span>-&gt; <span class=o>!</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>dp</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>pac</span>::<span class=n>Peripherals</span>::<span class=n>take</span><span class=p>().</span><span class=n>unwrap</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>porta</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>PinsA</span>::<span class=n>new</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=n>dp</span><span class=p>.</span><span class=no>SYSCONFIG</span><span class=p>,</span><span class=w> </span><span class=nb>Some</span><span class=p>(</span><span class=n>dp</span><span class=p>.</span><span class=no>IOCONFIG</span><span class=p>),</span><span class=w> </span><span class=n>dp</span><span class=p>.</span><span class=no>PORTA</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>led1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>porta</span><span class=p>.</span><span class=n>pa10</span><span class=p>.</span><span class=n>into_push_pull_output</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>led2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>porta</span><span class=p>.</span><span class=n>pa7</span><span class=p>.</span><span class=n>into_push_pull_output</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>led3</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>porta</span><span class=p>.</span><span class=n>pa6</span><span class=p>.</span><span class=n>into_push_pull_output</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=n>_</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=mi>0</span><span class=o>..</span><span class=mi>10</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>led1</span><span class=p>.</span><span class=n>set_low</span><span class=p>().</span><span class=n>ok</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>led2</span><span class=p>.</span><span class=n>set_low</span><span class=p>().</span><span class=n>ok</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>led3</span><span class=p>.</span><span class=n>set_low</span><span class=p>().</span><span class=n>ok</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>cortex_m</span>::<span class=n>asm</span>::<span class=n>delay</span><span class=p>(</span><span class=mi>5_000_000</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>led1</span><span class=p>.</span><span class=n>set_high</span><span class=p>().</span><span class=n>ok</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>led2</span><span class=p>.</span><span class=n>set_high</span><span class=p>().</span><span class=n>ok</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>led3</span><span class=p>.</span><span class=n>set_high</span><span class=p>().</span><span class=n>ok</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>cortex_m</span>::<span class=n>asm</span>::<span class=n>delay</span><span class=p>(</span><span class=mi>5_000_000</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>loop</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>led1</span><span class=p>.</span><span class=n>toggle</span><span class=p>().</span><span class=n>ok</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>cortex_m</span>::<span class=n>asm</span>::<span class=n>delay</span><span class=p>(</span><span class=mi>5_000_000</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>led2</span><span class=p>.</span><span class=n>toggle</span><span class=p>().</span><span class=n>ok</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>cortex_m</span>::<span class=n>asm</span>::<span class=n>delay</span><span class=p>(</span><span class=mi>5_000_000</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>led3</span><span class=p>.</span><span class=n>toggle</span><span class=p>().</span><span class=n>ok</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>cortex_m</span>::<span class=n>asm</span>::<span class=n>delay</span><span class=p>(</span><span class=mi>5_000_000</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>A lot more readble and neat that the low level PAC version.</p><p>Equipped with a lot more knowledge, I implemented a HAL for all other peripherals, using
what I saw in different HALs like the ATSAMD HAL or the STM32 HALs. Writing the basic blocking API
was mostly straighforward once I got more familiar with writing HAL code. I still have to
write code which is able to use interrupts to efficiently clear the various FIFOs. Using these FIFOs
reduces CPU load is the only sensible for peripherals like the UART to efficiently receive all
arriving RX data.</p><p>As a final step, I also implemented a Board Support Package targeted towards the REB1 development
board. This also was an excellent way for me to test the I2C implementation because that board
was equiped with a simple ADT75 I2C temperature sensor device.</p><p>The example application looks like this now</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rs data-lang=rs><span class=line><span class=cl><span class=cp>#![no_main]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cp>#![no_std]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>use</span><span class=w> </span><span class=n>cortex_m_rt</span>::<span class=n>entry</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>use</span><span class=w> </span><span class=n>panic_rtt_target</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>_</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>use</span><span class=w> </span><span class=n>rtt_target</span>::<span class=p>{</span><span class=n>rprintln</span><span class=p>,</span><span class=w> </span><span class=n>rtt_init_print</span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>use</span><span class=w> </span><span class=n>va108xx_hal</span>::<span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>pac</span>::<span class=p>{</span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>interrupt</span><span class=p>},</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>prelude</span>::<span class=o>*</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>timer</span>::<span class=p>{</span><span class=n>default_ms_irq_handler</span><span class=p>,</span><span class=w> </span><span class=n>set_up_ms_timer</span><span class=p>,</span><span class=w> </span><span class=n>Delay</span><span class=p>},</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>use</span><span class=w> </span><span class=n>vorago_reb1</span>::<span class=n>temp_sensor</span>::<span class=n>Adt75TempSensor</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cp>#[entry]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span>-&gt; <span class=o>!</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=fm>rtt_init_print!</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=fm>rprintln!</span><span class=p>(</span><span class=s>&#34;-- Vorago Temperature Sensor and I2C Example --&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>dp</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>pac</span>::<span class=n>Peripherals</span>::<span class=n>take</span><span class=p>().</span><span class=n>unwrap</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>tim0</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>set_up_ms_timer</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=n>dp</span><span class=p>.</span><span class=no>SYSCONFIG</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=n>dp</span><span class=p>.</span><span class=no>IRQSEL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=mf>50.</span><span class=n>mhz</span><span class=p>().</span><span class=n>into</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>dp</span><span class=p>.</span><span class=no>TIM0</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>interrupt</span>::<span class=no>OC0</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>delay</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Delay</span>::<span class=n>new</span><span class=p>(</span><span class=n>tim0</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>unsafe</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>cortex_m</span>::<span class=n>peripheral</span>::<span class=no>NVIC</span>::<span class=n>unmask</span><span class=p>(</span><span class=n>pac</span>::<span class=n>Interrupt</span>::<span class=no>OC0</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>temp_sensor</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Adt75TempSensor</span>::<span class=n>new</span><span class=p>(</span><span class=n>dp</span><span class=p>.</span><span class=no>I2CA</span><span class=p>,</span><span class=w> </span><span class=mf>50.</span><span class=n>mhz</span><span class=p>(),</span><span class=w> </span><span class=nb>Some</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=n>dp</span><span class=p>.</span><span class=no>SYSCONFIG</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=n>expect</span><span class=p>(</span><span class=s>&#34;Creating temperature sensor struct failed&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>loop</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>temp</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>temp_sensor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=n>read_temperature</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=n>expect</span><span class=p>(</span><span class=s>&#34;Failed reading temperature&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=fm>rprintln!</span><span class=p>(</span><span class=s>&#34;Temperature in Celcius: {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>temp</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>delay</span><span class=p>.</span><span class=n>delay_ms</span><span class=p>(</span><span class=mi>500</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cp>#[interrupt]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>OC0</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>default_ms_irq_handler</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>In my opinion, all the abstractions made this code really neat a brief. In this example, one
can also see a few more features being used:</p><ol><li>The RTT logger, which worked more or less out of the box. Really useful to get debugging output</li><li>An interrupt being used to get a MS timer tick. The Cortex-M0 does not really have
a SysTick peripheral suitable for this task, but the 24 TIM peripherals can be set up to generate
millisecond or second interrupts without issues. For something common like a millisecond counter,
I set up default setup functions and IRQ handlers like seen in the code above.</li><li>A temperature sensor abstraction provided by the BSP, which makes this example application really
concise.</li></ol><p>And this is what the output looks like after flashing the board with</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rs data-lang=rs><span class=line><span class=cl><span class=n>cargo</span><span class=w> </span><span class=n>run</span><span class=w> </span><span class=o>--</span><span class=n>example</span><span class=w> </span><span class=n>adt75</span><span class=o>-</span><span class=n>temp</span><span class=o>-</span><span class=n>sensor</span><span class=w>
</span></span></span></code></pre></div><center><figure><img loading=lazy src=/img/rust-ecosystem/temp-sensor.png alt="Reading a temperature sensor in Rust"><figcaption><p>Reading a temperature sensor in Rust</p></figcaption></figure></center><p>I would also like to write a bit about the development workflow I am using. It is possible doing
debugging using a graphical user interface which is important for any application which is more
complex in my opinion. I am using VS code for this and I&rsquo;m really happy with the development
workflow. All that is required is the <code>Cortex-Debug</code> plugin.</p><p>An example <code>launch.json</code> file for VS code looks like this</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;0.2.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;configurations&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;cortex-debug&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;request&#34;</span><span class=p>:</span> <span class=s2>&#34;launch&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Debug Blinky&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;servertype&#34;</span><span class=p>:</span> <span class=s2>&#34;jlink&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;cwd&#34;</span><span class=p>:</span> <span class=s2>&#34;${workspaceRoot}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;device&#34;</span><span class=p>:</span> <span class=s2>&#34;VA10820&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;svdFile&#34;</span><span class=p>:</span> <span class=s2>&#34;../va108xx-rs/va108xx.svd&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;preLaunchTask&#34;</span><span class=p>:</span> <span class=s2>&#34;rust: cargo build minimal blinky&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;executable&#34;</span><span class=p>:</span> <span class=s2>&#34;${workspaceFolder}/target/thumbv6m-none-eabi/debug/examples/blinky-leds&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;interface&#34;</span><span class=p>:</span> <span class=s2>&#34;jtag&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;runToMain&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>and an example <code>tasks.json</code> file like this</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;2.0.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;tasks&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;label&#34;</span><span class=p>:</span> <span class=s2>&#34;rust: cargo build blinky&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;shell&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;command&#34;</span><span class=p>:</span> <span class=s2>&#34;~/.cargo/bin/cargo&#34;</span><span class=p>,</span> <span class=c1>// note: full path to the cargo
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nt>&#34;args&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;build&#34;</span><span class=p>,</span> <span class=s2>&#34;--example&#34;</span><span class=p>,</span> <span class=s2>&#34;blinky-leds&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;group&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;kind&#34;</span><span class=p>:</span> <span class=s2>&#34;build&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;isDefault&#34;</span><span class=p>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>with this, we can soon use the Run & Debug tab of VS code to debug our applications</p><center><figure><img loading=lazy src=/img/rust-ecosystem/vs-code.png alt="Debugging with VS Code"><figcaption><p>Debugging with VS Code</p></figcaption></figure></center><p>Implementing a full Rust ecosystem for the VA10820 has been a challenging but satisfying task. I
think Rust offers excellent features which are really useful to write safe code for space
applications and I hope that some of the code I have written will be used to run awesome missions
soon.</p><p>In the meantime, I also managed to procure a
<a href=https://www.voragotech.com/products/peb1va416x0-development-kit>PEB1 development board</a> for
the <a href=https://www.voragotech.com/products/va416xx/bga>VA416xx familyof devices</a>. I also want to
thank <a href=https://www.thalesgroup.com/en/global/activities/space>Thales Alenia Space</a> for providing
me with this expensive hardware.
I am also trying to get the industry version of the
<a href=http://ww1.microchip.com/downloads/en/DeviceDoc/00003161A.pdf>SAMRH71</a> MCU. Time to write more
Rust code!</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://robamu.github.io/tags/rust/>Rust</a></li><li><a href=https://robamu.github.io/tags/embedded/>Embedded</a></li><li><a href=https://robamu.github.io/tags/space/>Space</a></li><li><a href=https://robamu.github.io/tags/va10820/>Va10820</a></li></ul><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Bringing Rust to Space - Setting up a Rust ecosystem for the VA108XX MCU family on x" href="https://x.com/intent/tweet/?text=Bringing%20Rust%20to%20Space%20-%20Setting%20up%20a%20Rust%20ecosystem%20for%20the%20VA108XX%20MCU%20family&amp;url=https%3a%2f%2frobamu.github.io%2fblog%2frust-ecosystem%2f&amp;hashtags=rust%2cembedded%2cspace%2cva10820"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Bringing Rust to Space - Setting up a Rust ecosystem for the VA108XX MCU family on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2frobamu.github.io%2fblog%2frust-ecosystem%2f&amp;title=Bringing%20Rust%20to%20Space%20-%20Setting%20up%20a%20Rust%20ecosystem%20for%20the%20VA108XX%20MCU%20family&amp;summary=Bringing%20Rust%20to%20Space%20-%20Setting%20up%20a%20Rust%20ecosystem%20for%20the%20VA108XX%20MCU%20family&amp;source=https%3a%2f%2frobamu.github.io%2fblog%2frust-ecosystem%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Bringing Rust to Space - Setting up a Rust ecosystem for the VA108XX MCU family on reddit" href="https://reddit.com/submit?url=https%3a%2f%2frobamu.github.io%2fblog%2frust-ecosystem%2f&title=Bringing%20Rust%20to%20Space%20-%20Setting%20up%20a%20Rust%20ecosystem%20for%20the%20VA108XX%20MCU%20family"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Bringing Rust to Space - Setting up a Rust ecosystem for the VA108XX MCU family on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2frobamu.github.io%2fblog%2frust-ecosystem%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Bringing Rust to Space - Setting up a Rust ecosystem for the VA108XX MCU family on whatsapp" href="https://api.whatsapp.com/send?text=Bringing%20Rust%20to%20Space%20-%20Setting%20up%20a%20Rust%20ecosystem%20for%20the%20VA108XX%20MCU%20family%20-%20https%3a%2f%2frobamu.github.io%2fblog%2frust-ecosystem%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Bringing Rust to Space - Setting up a Rust ecosystem for the VA108XX MCU family on telegram" href="https://telegram.me/share/url?text=Bringing%20Rust%20to%20Space%20-%20Setting%20up%20a%20Rust%20ecosystem%20for%20the%20VA108XX%20MCU%20family&amp;url=https%3a%2f%2frobamu.github.io%2fblog%2frust-ecosystem%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Bringing Rust to Space - Setting up a Rust ecosystem for the VA108XX MCU family on ycombinator" href="https://news.ycombinator.com/submitlink?t=Bringing%20Rust%20to%20Space%20-%20Setting%20up%20a%20Rust%20ecosystem%20for%20the%20VA108XX%20MCU%20family&u=https%3a%2f%2frobamu.github.io%2fblog%2frust-ecosystem%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//https-robamu-github-io.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></main><script data-goatcounter=https://robamu.goatcounter.com/count async src=//gc.zgo.at/count.js></script><footer class=footer><span>&copy; 2025 <a href=https://robamu.github.io/>hi, I am robin</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>